const { readFileSync } = require('fs');
const { Script, createContext } = require('vm');
const { TeleBot } = require('telebot');


let sandbox = {
    require: require,
    console: console,
    fetch: fetch,
};

async function run(file, inputParameters) {
    const fileString = readFileSync(file, { encoding: 'utf8' });

    const context = createContext(sandbox);
    const script = new Script(fileString, { timeout: 60000 });
    script.runInContext(context);

    // Assume the function name is 'mainFunction'
    const mainFunction = context.mainFunction;
    if (typeof mainFunction === 'function') {
        const result = await mainFunction(inputParameters);
        return result;
    } else {
        return null;
    }
}

run(
    './examples/telegramAlarmBot.js',
    "0x0000000000000000000000000000000000000000000000000000000000000100ffffffffffffffffffffffffffffffffffffffffffffffffffffffffc8e86cbd000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000000000001a00000000000000000000000000000000000000000000000000de0b6b3a764000000000000000000000000000000000000000000000000000000000000000051c900000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000002e363239353434383833323a414146425f30734d5f503331516a796c5f503154766c667a645569704c4238694e756f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000045746544d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000045553444300000000000000000000000000000000000000000000000000000000"
)
    .then((res) => {
        console.log(res);
        process.exit(0);
    }).catch((error) => {
        console.error(error);
        process.exit("1");
    });
